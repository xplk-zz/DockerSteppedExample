version: '2'
networks:
  front:
    driver: bridge
  back:
    driver: bridge
services:
  app:
    build:
      context: ./our_app/
    volumes:
      - ../webroot:/var/www/our_app:Z
    networks:
      - front
      - back
  varnish:
    image: tutum/varnish:4.0
    environment:
      LISTEN_PORT: 8081
    ports:
      - "8889:8081"
    links:
      - nginx
    networks:
      - front
  nginx:
    build:
      context: ./nginx/
    networks:
      front:
        aliases:
          - "backend"
          - "our_app.dev"
    ports:
      - "8888:80"
    volumes_from:
      - app
    links:
      - app
  mysql:
    image: mysql:5.6
    environment:
      MYSQL_ROOT_PASSWORD: root
    ports:
      - "8886:3306"
    volumes:
      - ../db_dump:/docker-entrypoint-initdb.d:Z
    networks:
      - back
